{% extends "layout.html" %}
{% block content %}
<body>
    <h1>Match from {{ match.created_at.strftime('%Y-%m-%d %H:%M') }}</h1>

    {% if match and match.courts %}
        <div class="courts-grid">
            {% for court in match.courts %}
                <div class="court-card">
                    <h3 class="court-title">Court {{ court.court_number }}</h3>
                    
                    {% set court_players = court.court_players | sort(attribute='id') %}
                    
                    <div class="team">
                        <div class="team-info">
                            <strong>Team 1:</strong>
                            <span class="player-name-display">{{ court_players[0].player_name if court_players|length > 0 else '—' }}</span> &
                            <span class="player-name-display">{{ court_players[1].player_name if court_players|length > 1 else '—' }}</span>
                        </div>
                        <div class="declare-button">
                            {% if court.winning_team is none %}
                                <form method="POST" action="{{ url_for('set_winner', court_id=court.id, team_number=1) }}">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <button type="submit" class="winner-btn">Declare Winner</button>
                                </form>
                            {% elif court.winning_team == 1 %}
                                <span class="winner-badge">🏆 Winner</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="team">
                        <div class="team-info">
                            <strong>Team 2:</strong>
                            <span class="player-name-display">{{ court_players[2].player_name if court_players|length > 2 else '—' }}</span> &
                            <span class="player-name-display">{{ court_players[3].player_name if court_players|length > 3 else '—' }}</span>
                        </div>
                        <div class="declare-button">
                            {% if court.winning_team is none %}
                                <form method="POST" action="{{ url_for('set_winner', court_id=court.id, team_number=2) }}">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <button type="submit" class="winner-btn">Declare Winner</button>
                                </form>
                            {% elif court.winning_team == 2 %}
                                <span class="winner-badge">🏆 Winner</span>
                            {% endif %}
                        </div>
                    </div>
                </div> <!-- court-card -->
            {% endfor %}
        </div> <!-- courts-grid -->

        <div class="resting-players">
            <h2>Players on Rest</h2>
            {% if resting_players %}
                <ul>
                    {% for player_name in resting_players %}
                        <li>{{ player_name }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No players were resting for this match.</p>
            {% endif %}
        </div>
    {% else %}
        <p>There is no match data to display.</p>
    {% endif %}
    <br>

    <div class="page-actions">
        <form method="POST" action="{{ url_for('regenerate_match', previous_match_id=match.id) }}" class="action-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="regen-button">
                ⟳ Regenerate
            </button>
        </form>
        <a href="{{ url_for('match_history') }}" class="btn">View All History</a>
        <a href="{{ url_for('draft') }}" class="btn">Back to Draft</a>
    </div>

</body>

{% endblock %}
